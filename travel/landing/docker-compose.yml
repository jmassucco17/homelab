services:
  travel-landing:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: travel-landing
    restart: unless-stopped
    ports:
      - '8003:80'
    networks:
      - web
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.travel-landing.rule=Host(`travel.jamesmassucco.com`)"
      - "traefik.http.routers.travel-landing.entrypoints=websecure"
      - "traefik.http.routers.travel-landing.tls.certresolver=cloudflare"
      - "traefik.http.services.travel-landing.loadbalancer.server.port=80"
    healthcheck:
      test:
        [
          'CMD',
          'python3',
          '-c',
          "import urllib.request; urllib.request.urlopen('http://127.0.0.1:80/health')",
        ]
      interval: 5s
      timeout: 1s
      retries: 3
      start_period: 5s

networks:
  web:
    external: true
