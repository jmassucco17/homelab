{% extends "base.html.jinja2" %}

{% block title %}Catan{% endblock %}

{% block extra_head %}
  <style>
    /* Override body overflow so the game canvas fills the viewport */
    body {
      overflow: hidden;
    }
  </style>
{% endblock %}

{% block content %}
  <div id="catan-game-area" class="catan-game-area">
    <!-- ------------------------------------------------------------------ -->
    <!-- Waiting room (visible until the game starts)                        -->
    <!-- ------------------------------------------------------------------ -->
    <div id="waiting-room" class="catan-waiting-room">
      <h2>üèùÔ∏è Catan ‚Äî Waiting Room</h2>
      <p>
        Room Code:
        <strong id="room-code-display" class="room-code-badge">----</strong>
      </p>
      <p class="waiting-hint">Share this code with friends so they can join!</p>

      <div id="waiting-players-list" class="waiting-players-list"></div>

      <div class="waiting-room-actions">
        <button id="add-ai-btn" class="lobby-btn">ü§ñ Add AI Player</button>
        <button id="start-game-btn" class="lobby-btn primary" disabled>‚ñ∂ Start Game</button>
      </div>

      <p class="waiting-note">Start Game requires at least 2 players.</p>
    </div>

    <!-- ------------------------------------------------------------------ -->
    <!-- Active game layout (hidden until the game starts)                   -->
    <!-- ------------------------------------------------------------------ -->
    <div id="game-area" class="catan-game-layout hidden">
      <!-- Board canvas -->
      <div class="catan-board-container" id="board-container">
        <canvas id="catan-board-canvas"></canvas>
      </div>

      <!-- Right panel -->
      <div class="catan-side-panel" id="catan-ui-container">
        <!-- Connection status -->
        <div id="connection-status" class="connection-status">üü° Connecting‚Ä¶</div>

        <!-- Dice display -->
        <div id="catan-dice-display" class="catan-dice-display">üé≤ ‚Äî</div>

        <!-- All-players overview -->
        <div id="catan-players-panel" class="catan-players-panel"></div>

        <!-- Local player hand -->
        <div id="catan-hand-panel" class="catan-hand-panel"></div>

        <!-- Build menu -->
        <div id="catan-build-menu" class="catan-build-menu"></div>

        <!-- Roll dice / end turn / bank trade buttons -->
        <div id="catan-action-buttons" class="catan-action-buttons"></div>

        <!-- Trade notifications (shows active trade offers) -->
        <div id="catan-trade-notifications" class="catan-trade-notifications" style="display: none"></div>

        <!-- Contextual build hint (shown briefly when player clicks a build button) -->
        <div id="catan-build-hint" class="catan-build-hint" style="display: none"></div>

        <!-- Scrollable action history log -->
        <div id="catan-action-log" class="catan-action-log"></div>
      </div>
    </div>

    <!-- ------------------------------------------------------------------ -->
    <!-- Toast notification container                                        -->
    <!-- ------------------------------------------------------------------ -->
    <div id="toast-container" class="toast-container"></div>

    <!-- ------------------------------------------------------------------ -->
    <!-- Game-over overlay                                                   -->
    <!-- ------------------------------------------------------------------ -->
    <div id="catan-game-over" class="catan-game-over-overlay" style="display: none">
      <div class="game-over-card">
        <div id="game-over-message" class="game-over-message"></div>
        <a href="/catan" class="lobby-btn primary">Back to Lobby</a>
      </div>
    </div>

    <!-- ------------------------------------------------------------------ -->
    <!-- AI Difficulty Selection Modal                                       -->
    <!-- ------------------------------------------------------------------ -->
    <div id="ai-difficulty-modal" class="modal-overlay" style="display: none">
      <div class="modal-card">
        <h3>Select AI Difficulty</h3>
        <p>Choose the difficulty level for the AI player:</p>
        <div class="modal-actions">
          <button class="lobby-btn" data-difficulty="easy">Easy</button>
          <button class="lobby-btn" data-difficulty="medium">Medium</button>
          <button class="lobby-btn" data-difficulty="hard">Hard</button>
        </div>
        <button id="ai-modal-cancel" class="lobby-btn secondary" style="margin-top: 10px">Cancel</button>
      </div>
    </div>

    <!-- ------------------------------------------------------------------ -->
    <!-- Bank Trade Modal                                                     -->
    <!-- ------------------------------------------------------------------ -->
    <div id="bank-trade-modal" class="modal-overlay" style="display: none">
      <div class="modal-card trade-modal-card">
        <h3>üîÑ Bank Trade</h3>
        <div class="trade-modal-section">
          <p class="trade-modal-label">You give:</p>
          <div id="bank-give-resources" class="trade-resource-picker"></div>
          <p id="bank-trade-ratio" class="trade-ratio-display" style="display: none"></p>
        </div>
        <div class="trade-modal-section" id="bank-receive-section" style="display: none">
          <p class="trade-modal-label">You receive:</p>
          <div id="bank-receive-resources" class="trade-resource-picker"></div>
        </div>
        <div class="modal-actions">
          <button id="bank-trade-confirm" class="lobby-btn primary" disabled>Confirm Trade</button>
          <button id="bank-trade-cancel" class="lobby-btn secondary">Cancel</button>
        </div>
      </div>
    </div>

    <!-- ------------------------------------------------------------------ -->
    <!-- Player Trade Modal                                                   -->
    <!-- ------------------------------------------------------------------ -->
    <div id="player-trade-modal" class="modal-overlay" style="display: none">
      <div class="modal-card trade-modal-card">
        <h3>ü§ù Propose Trade</h3>
        <div class="trade-modal-section">
          <p class="trade-modal-label">You offer:</p>
          <div id="player-trade-offering" class="trade-stepper-grid"></div>
        </div>
        <div class="trade-modal-section">
          <p class="trade-modal-label">You want:</p>
          <div id="player-trade-requesting" class="trade-stepper-grid"></div>
        </div>
        <div class="trade-modal-section">
          <p class="trade-modal-label">Offer to:</p>
          <div id="player-trade-targets" class="trade-player-targets"></div>
        </div>
        <div class="modal-actions">
          <button id="player-trade-confirm" class="lobby-btn primary" disabled>Propose Trade</button>
          <button id="player-trade-cancel" class="lobby-btn secondary">Cancel</button>
        </div>
      </div>
    </div>

    <!-- ------------------------------------------------------------------ -->
    <!-- Year of Plenty Modal                                                 -->
    <!-- ------------------------------------------------------------------ -->
    <div id="year-of-plenty-modal" class="modal-overlay" style="display: none">
      <div class="modal-card">
        <h3>üåü Year of Plenty</h3>
        <p>Choose 2 resources to receive from the bank:</p>
        <div id="yop-resources" class="trade-resource-picker"></div>
        <p id="yop-selection-display" class="trade-selection-display">Selected: none</p>
        <div class="modal-actions">
          <button id="yop-confirm" class="lobby-btn primary" disabled>Confirm</button>
          <button id="yop-cancel" class="lobby-btn secondary">Cancel</button>
        </div>
      </div>
    </div>

    <!-- ------------------------------------------------------------------ -->
    <!-- Monopoly Modal                                                       -->
    <!-- ------------------------------------------------------------------ -->
    <div id="monopoly-modal" class="modal-overlay" style="display: none">
      <div class="modal-card">
        <h3>üí∞ Monopoly</h3>
        <p>Choose a resource to take from all opponents:</p>
        <div id="monopoly-resources" class="trade-resource-picker"></div>
        <div class="modal-actions">
          <button id="monopoly-confirm" class="lobby-btn primary" disabled>Confirm</button>
          <button id="monopoly-cancel" class="lobby-btn secondary">Cancel</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block extra_scripts %}
  <script type="module" src="/static/catan/catan.js?v={{ catan_version }}"></script>
{% endblock %}
