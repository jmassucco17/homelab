<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Travel Pictures - Admin</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }

      .header {
        background-color: #2c3e50;
        color: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 30px;
      }

      .upload-section {
        background-color: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #333;
      }

      input[type='file'],
      textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
      }

      textarea {
        resize: vertical;
        min-height: 80px;
      }

      .upload-btn {
        background-color: #3498db;
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 4px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      .upload-btn:hover {
        background-color: #2980b9;
      }

      .upload-btn:disabled {
        background-color: #bdc3c7;
        cursor: not-allowed;
      }

      .message {
        padding: 15px;
        border-radius: 4px;
        margin-bottom: 20px;
        display: none;
      }

      .message.success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .message.error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .pictures-list {
        background-color: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .picture-item {
        display: flex;
        align-items: center;
        padding: 15px;
        border-bottom: 1px solid #eee;
        gap: 15px;
      }

      .picture-thumbnail {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border-radius: 4px;
      }

      .picture-info {
        flex: 1;
      }

      .picture-title {
        font-weight: bold;
        margin-bottom: 5px;
      }

      .picture-meta {
        color: #666;
        font-size: 14px;
      }

      .delete-btn {
        background-color: #e74c3c;
        color: white;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      .delete-btn:hover {
        background-color: #c0392b;
      }

      .nav-link {
        color: #3498db;
        text-decoration: none;
        font-size: 16px;
      }

      .nav-link:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>Travel Pictures - Admin Panel</h1>
      <a href="/" class="nav-link">‚Üê View Public Gallery</a>
    </div>

    <div class="upload-section">
      <h2>Upload New Picture</h2>
      <form id="uploadForm" enctype="multipart/form-data">
        <div class="form-group">
          <label for="picture">Select Picture:</label>
          <input type="file" id="picture" name="file" accept="image/*" required />
        </div>
        <div class="form-group">
          <label for="description">Description (optional):</label>
          <textarea
            id="description"
            name="description"
            placeholder="Enter a description for this picture..."
          ></textarea>
        </div>
        <button type="submit" class="upload-btn" id="uploadBtn">Upload Picture</button>
      </form>

      <div id="message" class="message"></div>
    </div>

    <div class="pictures-list">
      <h2>Uploaded Pictures</h2>
      <div id="picturesList">
        <p>Loading pictures...</p>
      </div>
    </div>

    <script>
      // Upload form handling
      document.getElementById('uploadForm').addEventListener('submit', async (e) => {
        e.preventDefault()

        const formData = new FormData()
        const fileInput = document.getElementById('picture')
        const descriptionInput = document.getElementById('description')
        const uploadBtn = document.getElementById('uploadBtn')
        const messageDiv = document.getElementById('message')

        if (!fileInput.files[0]) {
          showMessage('Please select a picture to upload.', 'error')
          return
        }

        formData.append('file', fileInput.files[0])
        if (descriptionInput.value.trim()) {
          formData.append('description', descriptionInput.value.trim())
        }

        uploadBtn.disabled = true
        uploadBtn.textContent = 'Uploading...'

        try {
          const response = await fetch('/admin/upload', {
            method: 'POST',
            body: formData,
          })

          const result = await response.json()

          if (response.ok) {
            showMessage('Picture uploaded successfully!', 'success')
            document.getElementById('uploadForm').reset()
            loadPictures() // Reload the pictures list
          } else {
            showMessage(result.detail || 'Upload failed', 'error')
          }
        } catch (error) {
          showMessage('Upload failed: ' + error.message, 'error')
        } finally {
          uploadBtn.disabled = false
          uploadBtn.textContent = 'Upload Picture'
        }
      })

      // Show message function
      function showMessage(text, type) {
        const messageDiv = document.getElementById('message')
        messageDiv.textContent = text
        messageDiv.className = `message ${type}`
        messageDiv.style.display = 'block'

        setTimeout(() => {
          messageDiv.style.display = 'none'
        }, 5000)
      }

      // Load pictures list
      async function loadPictures() {
        try {
          const response = await fetch('/admin/pictures')
          const pictures = await response.json()

          const picturesListDiv = document.getElementById('picturesList')

          if (pictures.length === 0) {
            picturesListDiv.innerHTML = '<p>No pictures uploaded yet.</p>'
            return
          }

          picturesListDiv.innerHTML = pictures
            .map(
              (picture) => `
                    <div class="picture-item">
                        <img src="/pictures/${picture.id}/file" alt="${picture.original_filename}" class="picture-thumbnail">
                        <div class="picture-info">
                            <div class="picture-title">${picture.original_filename}</div>
                            <div class="picture-meta">
                                ${picture.description ? `<div>Description: ${picture.description}</div>` : ''}
                                <div>Uploaded: ${new Date(picture.upload_date).toLocaleDateString()}</div>
                                ${picture.date_taken ? `<div>Taken: ${new Date(picture.date_taken).toLocaleDateString()}</div>` : ''}
                                ${picture.latitude && picture.longitude ? `<div>Location: ${picture.latitude.toFixed(4)}, ${picture.longitude.toFixed(4)}</div>` : ''}
                                <div>Size: ${(picture.file_size / 1024 / 1024).toFixed(2)} MB</div>
                            </div>
                        </div>
                        <button class="delete-btn" onclick="deletePicture(${picture.id})">Delete</button>
                    </div>
                `,
            )
            .join('')
        } catch (error) {
          document.getElementById('picturesList').innerHTML = '<p>Failed to load pictures.</p>'
        }
      }

      // Delete picture function
      async function deletePicture(pictureId) {
        if (!confirm('Are you sure you want to delete this picture?')) {
          return
        }

        try {
          const response = await fetch(`/admin/pictures/${pictureId}`, {
            method: 'DELETE',
          })

          if (response.ok) {
            showMessage('Picture deleted successfully', 'success')
            loadPictures()
          } else {
            const result = await response.json()
            showMessage(result.detail || 'Failed to delete picture', 'error')
          }
        } catch (error) {
          showMessage('Failed to delete picture: ' + error.message, 'error')
        }
      }

      // Load pictures on page load
      loadPictures()
    </script>
  </body>
</html>
