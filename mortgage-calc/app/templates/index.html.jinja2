<!doctype html>
<html>
  <head>
    <title>Mortgage Calculator</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <h1>Mortgage Calculator</h1>

    <form method="post" action="/save">
      <label>Name this calculation:</label>
      <input type="text" name="name" value="{{ name if name else '' }}" required /><br />

      <label>House Price:</label>
      <input
        type="number"
        name="house_price"
        value="{{ loaded.house_price if loaded and 'house_price' in loaded else '' }}"
      /><br />

      <label>Downpayment:</label>
      <input
        type="number"
        name="downpayment"
        value="{{ loaded.downpayment if loaded and 'downpayment' in loaded else '' }}"
      /><br />

      <label>Interest Rate:</label>
      <input
        type="number"
        step="0.001"
        name="interest_rate"
        value="{{ loaded.interest_rate if loaded and 'interest_rate' in loaded else '' }}"
      /><br />

      <label>Term (years):</label>
      <input
        type="number"
        name="term_years"
        value="{{ loaded.term_years if loaded and 'term_years' in loaded else '' }}"
      /><br />

      <label>Home Insurance (monthly):</label>
      <input
        type="number"
        name="insurance"
        value="{{ loaded.insurance if loaded and 'insurance' in loaded else '' }}"
      /><br />

      <label>Utilities (monthly):</label>
      <input
        type="number"
        name="utilities"
        value="{{ loaded.utilities if loaded and 'utilities' in loaded else '' }}"
      /><br />

      <input type="hidden" name="data" id="data-field" />
      <button type="submit" onclick="prepareData()">Save</button>
    </form>

    <hr />

    <h2>Saved Calculations</h2>
    <ul>
      {% for calc in saved_calcs %}
      <li><a href="/calc/{{ calc[0] }}">{{ calc[1] }}</a></li>
      {% endfor %}
    </ul>

    <script>
      function prepareData() {
        const fields = [
          'house_price',
          'downpayment',
          'interest_rate',
          'term_years',
          'insurance',
          'utilities',
        ]
        const data = {}
        for (const field of fields) {
          const el = document.querySelector(`[name="${field}"]`)
          if (el) data[field] = el.value
        }
        document.getElementById('data-field').value = JSON.stringify(data)
      }
    </script>
  </body>
</html>
